# 《项目自检测软件》需求说明

## 1. 项目目标

为提供一套运行在工控机上的的自检测与状态监控软件，实现：

- 对工控机自身运行状态的实时监测与可视化；
    
- ==对充电箱、换电站等外部设备的自检控制与结果汇总展示；== 
    
- 对各模块的寿命 / 维护周期进行配置、统计与预警；
    
- 支持本地操作，也支持通过 Web 端远程访问同一套 QML 界面；
    
- 关键自检与寿命信息上报云平台，支持远程运维。
    

---

## 2. 运行环境与技术栈

- 操作系统：**Ubuntu 20.04 64 位** 及以上 
    
- 框架：**Qt 6.8.3**
    
- GUI：**QML**
    
- 消息通信：**RabbitMQ**
    
- 访问方式：
    
    - 本地：工控机上直接运行 QML GUI；
        
    - 远程：通过 Web 端访问 QML 界面（如：Qt WebAssembly / 内嵌浏览器访问服务端渲染界面等，具体方案在技术设计阶段确定）。
        

---

## 3. 功能需求

### 3.1 工控机状态检测

- 实时检测并展示工控机核心状态，包括但不限于：
    
    - 网络状态：是否联网、关键 IP / 服务连通性（如 RabbitMQ 服务器、充电箱/换电站控制端）；
        
    - 磁盘状态：使用率、剩余空间、SMART 状态（如可用）；
        
    - CPU / 内存占用：当前值、历史趋势（可选）；
        
    - 关键进程 / 服务状态：本软件相关后台服务是否在运行。
        
- 支持状态分类显示：**正常 / 警告 / 异常**（颜色或图标区分）。
    
- 支持刷新周期配置（例如：1s / 5s / 10s 等）。
    

### 3.2 充电箱自检（通过 RabbitMQ）

- 通过 RabbitMQ 下发“充电箱自检指令”：
    
    - 采用约定的交换机 / 队列名和消息格式（如 JSON），包含设备标识、自检类型等；
        
- 通过 RabbitMQ 接收“充电箱自检结果”：
    
    - 自检结果包括但不限于：
        
        - 通讯状态；
            
        - 主控 / 电源模块状态；
            
        - 接插件 / 枪头状态；
            
        - 安全保护状态；
            
        - 其他业务相关状态字段。
            
- 在界面中以模块化方式展示自检结果：
    
    - 每个子模块单独卡片 / 面板，展示“当前状态 + 详情 + 时间戳”；
        
- 支持操作：
    
    - 本地 GUI 按钮触发一次自检；
        
    - Web 端远程触发一次自检（权限可控）。
        

### 3.3 换电站自检（通过 RabbitMQ）

- 通过 RabbitMQ 下发“换电站自检指令”；
    
- 通过 RabbitMQ 接收“换电站自检结果”：
    
    - 包括：总体状态、机械机构状态、电气模块状态、安全 / 急停状态等；
        
- 展示形式与充电箱自检保持一致，方便统一运维；
    
- 支持本地 / Web 端均可触发换电站自检指令。
    

### 3.4 模块寿命配置与管理

- 寿命配置按模块管理，例如：
    
    - 充电箱关键部件；
        
    - 换电站机械 / 电气模块；
        
    - 工控机内部分软硬件模块（可选）。
        
- 支持为每个模块配置：
    
    - **设计寿命周期**：例如 5 年；
        
    - **预警阈值**：例如剩余寿命 6 个月 / 3 个月开始预警；
        
    - **到期策略**：仅报警 / 禁止继续工作（视业务需要）。
        
- 寿命统计策略：
    
    - 模块上报自身“剩余寿命”或“安装时间”等信息；
        
    - 软件端维护时间轴，例如：设定寿命 5 年，则每天自动将剩余寿命 -1 天；
        
    - 当剩余寿命低于预警阈值时，触发预警事件。
        
- 配置管理：
    
    - 支持通过界面修改寿命配置（初始寿命、预警规则等）。
        
    - 支持“更换部件”操作，一键重置某模块寿命计数。
        
    - 支持导入 / 导出寿命配置（如 JSON/YAML），方便批量部署。
        

### 3.5 寿命与预警可视化

- 在“寿命管理”页面展示：
    
    - 各模块当前剩余寿命（以天 / 年为单位，或百分比）；
        
    - 当前状态：正常 / 即将到期 / 已超期；
        
    - 最近维护时间、下次建议维护时间。
        
- 预警能力：
    
    - 当寿命接近阈值时，在界面明显位置提示，如高亮 / 弹窗 / 列表红色标记；
        
    - 可选：支持将预警信息上报到云平台并记录日志。
        

### 3.6 Web 访问与远程操作

- Web 端功能范围：
    
    - 监控工控机状态、自检结果、模块寿命信息；
        
    - 允许在具有权限的前提下：
        
        - 远程下发充电箱自检指令；
            
        - 远程下发换电站自检指令；
            
        - 修改模块寿命配置（可根据角色限制）。
            
- 权限控制：
    
    - 区分“查看权限”和“控制权限”；
        
    - 通过简单账号密码 / Token 管理（具体实现待技术方案确定）。
        

### 3.7 云平台对接

- 对云平台上报的内容包括但不限于：
    
    - 工控机周期性状态摘要（CPU/内存/磁盘/网络）；
        
    - 充电箱、换电站自检结果摘要；
        
    - 模块寿命接近阈值、寿命超期等预警事件；
        
- 上报方式：
    
    - 通过已有云平台接口（如 HTTP REST / MQTT / RabbitMQ 中转），具体以项目既有架构为准；
        
    - 支持离线缓存机制：在网络中断时本地缓存，上线后补传（如有需要）。
        

---

## 4. 非功能需求

- **稳定性**：支持 7×24 小时长期运行，无显著内存泄漏和界面卡死；
    
- **日志记录**：
    
    - 记录指令下发、结果接收、寿命变更与预警事件；
        
    - 支持按时间范围查询日志；
        
- **可扩展性**：
    
    - 新增设备类型时，只需在 RabbitMQ 中增加相应路由与消息格式映射；
        
    - 界面层通过统一组件展示不同设备自检结果。
        

---

## 5. 后续可细化内容

- RabbitMQ 交换机 / 队列 / RoutingKey 命名规范；
    
- 自检指令与结果的消息体 JSON 协议定义；
    
- 模块寿命配置的数据结构与存储方式；
    
- Web 访问架构（基于 Qt / 独立 Web 服务 / WebAssembly 等方案比较）。